(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{113:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return s})),n.d(t,"h",(function(){return b})),n.d(t,"i",(function(){return i}));var r=function(e,t,n){var r;return function(){var a=null,o=arguments,i=function(){r=null,n||e.apply(a,o)},s=n&&!r;clearTimeout(r),r=window.setTimeout(i,t),s&&e.apply(a,o)}},a=function(e){var t=e.replace("#","");return.299*parseInt(t.slice(0,2),16)+.587*parseInt(t.slice(2,4),16)+.114*parseInt(t.slice(4,6),16)>186?"#000000":"#FFFFFF"},o=function(e){var t="";if(e>=60&&e<3600){var n=Math.floor(e/60);t=n+" Min";var r=60===n?0:Math.floor(e%60);return t+(r>0?" "+r+" Sec":"")}if(e>=3600&&e<86400){var a=Math.floor(e/3600);t=a+" Hr";var o=e%3600<60||24===a?0:Math.floor(e%3600/60);return t+(o>0?" "+o+" Min":"")}if(e>=86400){var i=Math.floor(e/86400);t=i+" Day";var s=e%86400<3600||i>=364?0:Math.floor(e%86400/3600);return t+(s>0?" "+s+" Hr":"")}return Math.floor(e)+" Sec"},i=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=1024),void 0===n&&(n=!1);var r=e;return e.length>t&&(r=e.substring(0,t)),n&&(r+="..."),r};function s(e){try{var t=String(e).toLowerCase();return Boolean(JSON.parse(t))}catch(n){return!1}}function u(e){return e.slice().sort((function(e,t){return e-t}))}function l(e,t){var n,r,a,o=(r=1,(a=t)<(n=0)?n:a>r?r:a),i=(e.length-1)*o,s=Math.floor(i),u=i-s;return void 0!==e[s+1]?e[s]+u*(e[s+1]-e[s]):e[s]}var c=function(e,t){var n=u(e);return t.map((function(e){return l(n,e)}))},f=/{{(.*?)}}/g,m=function(e){return(e||"").replace(/\b(\w)/g,(function(e){return e.toUpperCase()}))},d=function(e){var t=e.user,n=null!=t&&t.name?t.name.split(" ").shift():"";return m(n)},p=function(e){var t=e.user;if(t&&t.name){var n=t.name.split(" ").length>1?t.name.split(" ").pop():"";return m(n)}return""},h=function(e){var t,n=e.conversation,r=n.meta,a=r.assignee,o=r.sender,i=n.id;return{"contact.name":m((null==o?void 0:o.name)||""),"contact.first_name":d({user:o}),"contact.last_name":p({user:o}),"contact.email":null==o?void 0:o.email,"contact.phone":null==o?void 0:o.phone_number,"contact.id":null==o?void 0:o.id,"conversation.id":i,"agent.name":m((null==a?void 0:a.name)||""),"agent.first_name":d({user:a}),"agent.last_name":p({user:a}),"agent.email":null!=(t=null==a?void 0:a.email)?t:""}},b=function(e){var t=e.message,n=e.variables;return t.replace(f,(function(e,t){return n[t.trim()]?n[t.trim().toLowerCase()]:""}))},g=function(e){var t=e.message,n=e.variables,r=t.replace(/```(?:.|\n)+?```/g,"").match(f);return r?r.map((function(e){return e.replace("{{","").replace("}}","").trim()})).filter((function(e){return!n[e]})):[]}},154:function(e,t,n){"use strict";n(44),n(47),n(62);var r=n(683),a=n.n(r),o=(n(347),n(630),n(137),/mention:\/\/(user|team)\/(\d+)\/(.+)/gm);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=n(377)({html:!1,xhtmlOut:!0,breaks:!0,langPrefix:"language-",linkify:!0,typographer:!0,quotes:"\u201c\u201d\u2018\u2019",maxNesting:20}).use((function(e){e.renderer.rules.mention=function(e,t){return'<span class="prosemirror-mention-node">'.concat(e[t].content,"</span>")},e.inline.ruler.before("link","mention",(function(e,t){var n,r,a,i,s,u,l="",c=e.posMax;return 91===e.src.charCodeAt(e.pos)&&(a=e.pos+1,!((r=e.md.helpers.parseLinkLabel(e,e.pos,!0))<0)&&(n=e.src.slice(a,r),(i=r+1)<c&&40===e.src.charCodeAt(i)&&(i+=1,(s=e.md.helpers.parseLinkDestination(e.src,i,e.posMax)).ok&&(l=e.md.normalizeLink(s.str),e.md.validateLink(l)?i=s.pos:l=""),i+=1),!!l.match(new RegExp(o))&&(t||(e.pos=a,e.posMax=r,(u=e.push("mention","")).href=l,u.content=n),e.pos=i,e.posMax=c,!0)))}))})).use(a.a,{attrs:{class:"link",rel:"noreferrer noopener nofollow",target:"_blank"}}),l=/(^|[^@\w])@(\w{1,15})\b/g,c=/(^|\s)#(\w+)/g,f=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i(this,e),this.message=t||"",this.isAPrivateNote=r,this.isATweet=n}var t,n,r;return t=e,(n=[{key:"formatMessage",value:function(){var e=this.message;return this.isATweet&&!this.isAPrivateNote&&(e=(e=e.replace(l,"$1[@$2](http://twitter.com/$2)")).replace(c,"$1[#$2](https://twitter.com/hashtag/$2)")),u.render(e)}},{key:"formattedMessage",get:function(){return this.formatMessage()}},{key:"plainText",get:function(){return(new DOMParser).parseFromString(this.formattedMessage,"text/html").body.textContent||""}}])&&s(t.prototype,n),r&&s(t,r),e}(),m=f;t.a={methods:{formatMessage:function(e,t,n){return new m(e,t,n).formattedMessage},getPlainText:function(e,t){return new m(e,t).plainText},truncateMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.length<100?e:"".concat(e.slice(0,97),"...")}}}},2916:function(e,t,n){},3067:function(e,t,n){"use strict";n(2916)},3099:function(e,t,n){"use strict";n.r(t);n(6),n(3),n(5),n(9),n(7),n(10);var r=n(4),a=(n(22),n(39),n(32),n(82),n(21),n(8),n(24),n(52),n(64),n(678)),o=n(70),i=n(113),s=n(154),u=n(90),l=n(589),c=n(281),f=n(346);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h={components:{CustomButton:a.a,Spinner:o.a},mixins:[l.a,c.a,s.a,f.a],props:{options:{type:Object,default:function(){}}},data:function(){return{locale:this.$root.$i18n.locale,message:"",formValues:{},labels:{emailAddress:"EMAIL_ADDRESS",fullName:"FULL_NAME",phoneNumber:"PHONE_NUMBER"}}},computed:d(d({},Object(r.mapGetters)({widgetColor:"appConfig/getWidgetColor",isCreating:"conversation/getIsCreating",activeCampaign:"campaign/getActiveCampaign",currentUser:"contacts/getCurrentUser"})),{},{textColor:function(){return Object(i.c)(this.widgetColor)},hasActiveCampaign:function(){return!Object(u.d)(this.activeCampaign)},shouldShowHeaderMessage:function(){return this.hasActiveCampaign||this.preChatFormEnabled},headerMessage:function(){return this.preChatFormEnabled?this.options.preChatMessage:this.hasActiveCampaign?this.$t("PRE_CHAT_FORM.CAMPAIGN_HEADER"):""},preChatFields:function(){return this.preChatFormEnabled?this.options.preChatFields:[]},filteredPreChatFields:function(){var e=!!this.currentUser.email,t=!!this.currentUser.phone_number,n=!!(!!this.currentUser.identifier||e||t);return this.preChatFields.filter((function(r){return(!e||"emailAddress"!==r.name)&&((!t||"phoneNumber"!==r.name)&&(!n||"fullName"!==r.name))}))},enabledPreChatFields:function(){var e=this;return this.filteredPreChatFields.filter((function(e){return e.enabled})).map((function(t){return d(d({},t),{},{type:e.findFieldType(t.type)})}))},conversationCustomAttributes:function(){var e=this,t={};return this.enabledPreChatFields.forEach((function(n){"conversation_attribute"===n.field_type&&(t=d(d({},t),{},p({},n.name,e.getValue(n))))})),t},contactCustomAttributes:function(){var e=this,t={};return this.enabledPreChatFields.forEach((function(n){"contact_attribute"===n.field_type&&(t=d(d({},t),{},p({},n.name,e.getValue(n))))})),t},inputStyles:function(){return"mt-2 border rounded w-full py-2 px-3 text-slate-700 outline-none"},isInputDarkOrLightMode:function(){return"".concat(this.$dm("bg-white","dark:bg-slate-600")," ").concat(this.$dm("text-slate-700","dark:text-slate-50"))},inputBorderColor:function(){return"".concat(this.$dm("border-black-200","dark:border-black-500"))}}),methods:{labelClass:function(e){var t=e.hasErrors;return"text-xs font-medium ".concat(t?this.$dm("text-red-400","dark:text-red-400"):this.$dm("text-black-800","dark:text-slate-50"))},inputClass:function(e){var t=e.hasErrors,n=e.classification,r=e.type;return"box"===n&&"checkbox"===r?"":t?"".concat(this.inputStyles," border-red-200 hover:border-red-300 focus:border-red-300 ").concat(this.isInputDarkOrLightMode):"".concat(this.inputStyles," hover:border-black-300 focus:border-black-300 ").concat(this.isInputDarkOrLightMode," ").concat(this.inputBorderColor)},isContactFieldRequired:function(e){return this.preChatFields.find((function(t){return t.name===e})).required},getLabel:function(e){return e.label},getPlaceHolder:function(e){return e.placeholder},getValue:function(e){var t=e.name;return"select"===e.type?this.enabledPreChatFields.find((function(e){return e.name===t})).values[this.formValues[t]]:this.formValues[t]||null},getValidation:function(e){var t=e.type,n=e.name;if(!this.isContactFieldRequired(n))return"";var r={emailAddress:"email",phoneNumber:"isPhoneE164OrEmpty",url:"url",date:"date",text:null,select:null,number:null,checkbox:!1},a=Object.keys(r),o="bail|required";if(a.includes(n)||a.includes(t)){var i=r[t]||r[n];return i?"".concat(o,"|").concat(i):o}return""},findFieldType:function(e){return"link"===e?"url":"list"===e?"select":e},getOptions:function(e){if("select"===e.type){var t={};return e.values.forEach((function(e,n){t=d(d({},t),{},p({},n,e))})),t}return null},onSubmit:function(){var e=this.formValues,t=e.emailAddress,n=e.fullName,r=e.phoneNumber,a=e.message,o=this.currentUser.email;this.$emit("submit",{fullName:n,phoneNumber:r,emailAddress:t||o,message:a,activeCampaignId:this.activeCampaign.id,conversationCustomAttributes:this.conversationCustomAttributes,contactCustomAttributes:this.contactCustomAttributes})}}},b=(n(3067),n(1));function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C={components:{PreChatForm:Object(b.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("FormulateForm",{staticClass:"flex flex-1 flex-col p-6 overflow-y-auto",on:{submit:e.onSubmit},model:{value:e.formValues,callback:function(t){e.formValues=t},expression:"formValues"}},[e.shouldShowHeaderMessage?n("div",{directives:[{name:"dompurify-html",rawName:"v-dompurify-html",value:e.formatMessage(e.headerMessage,!1),expression:"formatMessage(headerMessage, false)"}],staticClass:"mb-4 text-sm leading-5 pre-chat-header-message",class:e.$dm("text-black-800","dark:text-slate-50")}):e._e(),e._v(" "),e._l(e.enabledPreChatFields,(function(t){return n("FormulateInput",{key:t.name,attrs:{name:t.name,type:t.type,label:e.getLabel(t),placeholder:e.getPlaceHolder(t),validation:e.getValidation(t),options:e.getOptions(t),"label-class":function(t){return e.labelClass(t)},"input-class":function(t){return e.inputClass(t)},"validation-messages":{isPhoneE164OrEmpty:e.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.VALID_ERROR"),email:e.$t("PRE_CHAT_FORM.FIELDS.EMAIL_ADDRESS.VALID_ERROR"),required:e.$t("PRE_CHAT_FORM.REQUIRED")}}})})),e._v(" "),e.hasActiveCampaign?e._e():n("FormulateInput",{attrs:{name:"message",type:"textarea","label-class":function(t){return e.labelClass(t)},"input-class":function(t){return e.inputClass(t)},label:e.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.LABEL"),placeholder:e.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.PLACEHOLDER"),validation:"required","validation-messages":{required:e.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.ERROR")}}}),e._v(" "),n("custom-button",{staticClass:"font-medium my-5",attrs:{block:"","bg-color":e.widgetColor,"text-color":e.textColor,disabled:e.isCreating}},[e.isCreating?n("spinner",{staticClass:"p-0"}):e._e(),e._v("\n    "+e._s(e.$t("START_CONVERSATION"))+"\n  ")],1)],2)}),[],!1,null,"58c1b7d5",null).exports},mixins:[f.a,l.a],computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(r.mapGetters)({conversationSize:"conversation/getConversationSize"})),watch:{conversationSize:function(e,t){!t&&e>t&&this.replaceRoute("messages")}},methods:{onSubmit:function(e){var t=e.fullName,n=e.emailAddress,r=e.message,a=e.activeCampaignId,o=e.phoneNumber,i=e.contactCustomAttributes,s=e.conversationCustomAttributes;a?(bus.$emit("execute-campaign",{campaignId:a,customAttributes:s}),this.$store.dispatch("contacts/update",{user:{email:n,name:t,phone_number:o}})):this.$store.dispatch("conversation/createConversation",{fullName:t,emailAddress:n,message:r,phoneNumber:o,customAttributes:s}),Object(u.d)(i)||this.$store.dispatch("contacts/setCustomAttributes",i)}}},y=C,O=Object(b.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flex flex-1 overflow-auto"},[n("pre-chat-form",{attrs:{options:e.preChatFormOptions},on:{submit:e.onSubmit}})],1)}),[],!1,null,null,null);t.default=O.exports},678:function(e,t,n){"use strict";n(6);var r={props:{block:{type:Boolean,default:!1},type:{type:String,default:"blue"},bgColor:{type:String,default:""},textColor:{type:String,default:""},disabled:{type:Boolean,default:!1}},computed:{buttonClassName:function(){var e="text-white py-3 px-4 rounded shadow-sm";return"clear"===this.type&&(e="flex mx-auto mt-4 text-xs w-auto text-black-600"),"blue"!==this.type||Object.keys(this.buttonStyles).length||(e="".concat(e," bg-woot-500 hover:bg-woot-700")),this.block&&(e="".concat(e," w-full")),e},buttonStyles:function(){var e={};return this.bgColor&&(e.backgroundColor=this.bgColor),this.textColor&&(e.color=this.textColor),e}},methods:{onClick:function(e){this.$emit("click",e)}}},a=n(1),o=Object(a.a)(r,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("button",{class:e.buttonClassName,style:e.buttonStyles,attrs:{disabled:e.disabled},on:{click:e.onClick}},[e._t("default")],2)}),[],!1,null,null,null);t.a=o.exports}}]);
//# sourceMappingURL=30-683f39e9554e62ad48ba.chunk.js.map