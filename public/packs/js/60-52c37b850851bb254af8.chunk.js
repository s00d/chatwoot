(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{1901:function(t,e,n){"use strict";n(61),n(51),n(66),n(1765),n(136),n(18),n(8),n(21),n(23),n(204),n(10);var r=n(1903),a=n.n(r),i=(n(360),/mention:\/\/(user|team)\/(\d+)\/(.+)/gm);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var u=function(t){t.children.forEach((function(t){"image"===t.type&&function(t){var e=t.attrGet("src");if(e){var n=new URL(e).searchParams.get("cw_image_height");n&&t.attrSet("style","height: ".concat(n,";"))}}(t)}))},l=n(1796)({html:!1,xhtmlOut:!0,breaks:!0,langPrefix:"language-",linkify:!0,typographer:!0,quotes:"\u201c\u201d\u2018\u2019",maxNesting:20}).use((function(t){t.renderer.rules.mention=function(t,e){return'<span class="prosemirror-mention-node">'.concat(t[e].content,"</span>")},t.inline.ruler.before("link","mention",(function(t,e){var n,r,a,o,s,u,l="",c=t.posMax;return 91===t.src.charCodeAt(t.pos)&&(a=t.pos+1,!((r=t.md.helpers.parseLinkLabel(t,t.pos,!0))<0)&&(n=t.src.slice(a,r),(o=r+1)<c&&40===t.src.charCodeAt(o)&&(o+=1,(s=t.md.helpers.parseLinkDestination(t.src,o,t.posMax)).ok&&(l=t.md.normalizeLink(s.str),t.md.validateLink(l)?o=s.pos:l=""),o+=1),!!l.match(new RegExp(i))&&(e||(t.pos=a,t.posMax=r,(u=t.push("mention","")).href=l,u.content=n),t.pos=o,t.posMax=c,!0)))}))})).use((function(t){t.core.ruler.after("inline","add-image-height",(function(t){t.tokens.forEach((function(t){"inline"===t.type&&u(t)}))}))})).use(a.a,{attrs:{class:"link",rel:"noreferrer noopener nofollow",target:"_blank"}}),c=/(^|[^@\w])@(\w{1,15})\b/g,f=/(^|\s)#(\w+)/g,d=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o(this,t),this.message=e||"",this.isAPrivateNote=r,this.isATweet=n}var e,n,r;return e=t,(n=[{key:"formatMessage",value:function(){var t=this.message;return this.isATweet&&!this.isAPrivateNote&&(t=(t=t.replace(c,"$1[@$2](http://twitter.com/$2)")).replace(f,"$1[#$2](https://twitter.com/hashtag/$2)")),l.render(t)}},{key:"formattedMessage",get:function(){return this.formatMessage()}},{key:"plainText",get:function(){return(new DOMParser).parseFromString(this.formattedMessage,"text/html").body.textContent||""}}])&&s(e.prototype,n),r&&s(e,r),t}(),m=d;e.a={methods:{formatMessage:function(t,e,n){return new m(t,e,n).formattedMessage},getPlainText:function(t,e){return new m(t,e).plainText},truncateMessage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.length<100?t:"".concat(t.slice(0,97),"...")},highlightContent:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=this.getPlainText(t),a=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return r.replace(new RegExp("(".concat(a,")"),"ig"),'<span class="'.concat(n,'">$1</span>'))}}}},1903:function(t,e,n){"use strict";function r(t,e){e=e?Array.isArray(e)?e:[e]:[],Object.freeze(e);var n=t.renderer.rules.link_open||this.defaultRender;t.renderer.rules.link_open=function(t,r,a,i,o){var s=function(t,e){var n,r,a=t.attrs[t.attrIndex("href")][1];for(n=0;n<e.length;++n){if("function"!==typeof(r=e[n]).matcher)return r;if(r.matcher(a,r))return r}}(t[r],e),u=s&&s.attrs;return u&&function(t,e,n){Object.keys(n).forEach((function(r){var a,i=n[r];"className"===r&&(r="class"),(a=e[t].attrIndex(r))<0?e[t].attrPush([r,i]):e[t].attrs[a][1]=i}))}(r,t,u),n(t,r,a,i,o)}}r.defaultRender=function(t,e,n,r,a){return a.renderToken(t,e,n)},t.exports=r},1932:function(t,e,n){"use strict";n(11);var r={props:{block:{type:Boolean,default:!1},type:{type:String,default:"blue"},bgColor:{type:String,default:""},textColor:{type:String,default:""},disabled:{type:Boolean,default:!1}},computed:{buttonClassName:function(){var t="text-white py-3 px-4 rounded shadow-sm leading-4";return"clear"===this.type&&(t="flex mx-auto mt-4 text-xs leading-3 w-auto text-black-600"),"blue"!==this.type||Object.keys(this.buttonStyles).length||(t="".concat(t," bg-woot-500 hover:bg-woot-700")),this.block&&(t="".concat(t," w-full")),t},buttonStyles:function(){var t={};return this.bgColor&&(t.backgroundColor=this.bgColor),this.textColor&&(t.color=this.textColor),t}},methods:{onClick:function(t){this.$emit("click",t)}}},a=n(6),i=Object(a.a)(r,(function(){var t=this;return(0,t._self._c)("button",{class:t.buttonClassName,style:t.buttonStyles,attrs:{disabled:t.disabled},on:{click:t.onClick}},[t._t("default")],2)}),[],!1,null,null,null);e.a=i.exports},2648:function(t,e,n){"use strict";n(1765),n(51),n(136),n(61);e.a={methods:{getRegexp:function(t){var e=t.lastIndexOf("/");return new RegExp(t.slice(1,e),t.slice(e+1))}}}},3036:function(t,e,n){},311:function(t,e,n){"use strict";n.d(e,"a",(function(){return C})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"d",(function(){return a})),n.d(e,"e",(function(){return b})),n.d(e,"f",(function(){return c})),n.d(e,"g",(function(){return v})),n.d(e,"h",(function(){return s})),n.d(e,"i",(function(){return g})),n.d(e,"j",(function(){return o}));var r=function(t,e,n){var r;return function(){var a=null,i=arguments,o=function(){r=null,n||t.apply(a,i)},s=n&&!r;clearTimeout(r),r=window.setTimeout(o,e),s&&t.apply(a,i)}},a=function(t){var e=t.replace("#","");return.299*parseInt(e.slice(0,2),16)+.587*parseInt(e.slice(2,4),16)+.114*parseInt(e.slice(4,6),16)>186?"#000000":"#FFFFFF"},i=function(t){var e="";if(t>=60&&t<3600){var n=Math.floor(t/60);e=n+" Min";var r=60===n?0:Math.floor(t%60);return e+(r>0?" "+r+" Sec":"")}if(t>=3600&&t<86400){var a=Math.floor(t/3600);e=a+" Hr";var i=t%3600<60||24===a?0:Math.floor(t%3600/60);return e+(i>0?" "+i+" Min":"")}if(t>=86400){var o=Math.floor(t/86400);e=o+" Day";var s=t%86400<3600||o>=364?0:Math.floor(t%86400/3600);return e+(s>0?" "+s+" Hr":"")}return Math.floor(t)+" Sec"},o=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e=1024),void 0===n&&(n=!1);var r=t;return t.length>e&&(r=t.substring(0,e)),n&&(r+="..."),r};function s(t){try{var e=String(t).toLowerCase();return Boolean(JSON.parse(e))}catch(n){return!1}}function u(t){return t.slice().sort((function(t,e){return t-e}))}function l(t,e){var n,r,a,i=(r=1,(a=e)<(n=0)?n:a>r?r:a),o=(t.length-1)*i,s=Math.floor(o),u=o-s;return void 0!==t[s+1]?t[s]+u*(t[s+1]-t[s]):t[s]}var c=function(t,e){var n=u(t);return e.map((function(t){return l(n,t)}))};function f(){return f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},f.apply(this,arguments)}var d=/{{(.*?)}}/g,m=function(t){return(t||"").replace(/\b(\w)/g,(function(t){return t.toUpperCase()}))},h=function(t){var e=t.user,n=null!=e&&e.name?e.name.split(" ").shift():"";return m(n)},p=function(t){var e=t.user;if(e&&e.name){var n=e.name.split(" ").length>1?e.name.split(" ").pop():"";return m(n)}return""},b=function(t){var e,n=t.conversation,r=t.contact,a=n.meta,i=a.assignee,o=a.sender,s=n.id,u=n.custom_attributes,l=void 0===u?{}:u,c=(r||{}).custom_attributes;return f({},{"contact.name":m((null==o?void 0:o.name)||""),"contact.first_name":h({user:o}),"contact.last_name":p({user:o}),"contact.email":null==o?void 0:o.email,"contact.phone":null==o?void 0:o.phone_number,"contact.id":null==o?void 0:o.id,"conversation.id":s,"agent.name":m((null==i?void 0:i.name)||""),"agent.first_name":h({user:i}),"agent.last_name":p({user:i}),"agent.email":null!=(e=null==i?void 0:i.email)?e:""},Object.entries(l).reduce((function(t,e){var n=e[0],r=e[1];return t["conversation.custom_attribute."+n]=r,t}),{}),Object.entries(c).reduce((function(t,e){var n=e[0],r=e[1];return t["contact.custom_attribute."+n]=r,t}),{}))},g=function(t){var e=t.message,n=t.variables;return e.replace(d,(function(t,e){return n[e.trim()]?n[e.trim().toLowerCase()]:""}))},v=function(t){var e=t.message,n=t.variables,r=e.replace(/```(?:.|\n)+?```/g,"").match(d);return r?r.map((function(t){return t.replace("{{","").replace("}}","").trim()})).filter((function(t){return void 0===n[t]})):[]},C=function(t,e,n){var r=null,a=function(){r&&(clearTimeout(r),r=null,e())},i=function(){r&&clearTimeout(r),r=setTimeout((function(){a()}),n)};return{start:function(){r||t(),i()},stop:a}}},3300:function(t,e,n){"use strict";n(3036)},3363:function(t,e,n){"use strict";n.r(e);n(9),n(38),n(73),n(10),n(44),n(149),n(18),n(8),n(23),n(11),n(69),n(98),n(5),n(12),n(13);var r=n(1932),a=n(179),i=n(27),o=n(311),s=n(1901),u=n(87),l=n(1775),c=n(301),f=n(346),d=n(2648);function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){p(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b={components:{CustomButton:r.a,Spinner:a.a},mixins:[l.a,c.a,s.a,f.a,d.a],props:{options:{type:Object,default:function(){}}},data:function(){return{locale:this.$root.$i18n.locale,hasErrorInPhoneInput:!1,message:"",formValues:{},labels:{emailAddress:"EMAIL_ADDRESS",fullName:"FULL_NAME",phoneNumber:"PHONE_NUMBER"}}},computed:h(h({},Object(i.mapGetters)({widgetColor:"appConfig/getWidgetColor",isCreating:"conversation/getIsCreating",activeCampaign:"campaign/getActiveCampaign",currentUser:"contacts/getCurrentUser"})),{},{textColor:function(){return Object(o.d)(this.widgetColor)},hasActiveCampaign:function(){return!Object(u.d)(this.activeCampaign)},shouldShowHeaderMessage:function(){return this.hasActiveCampaign||this.preChatFormEnabled},headerMessage:function(){return this.preChatFormEnabled?this.options.preChatMessage:this.hasActiveCampaign?this.$t("PRE_CHAT_FORM.CAMPAIGN_HEADER"):""},preChatFields:function(){return this.preChatFormEnabled?this.options.preChatFields:[]},filteredPreChatFields:function(){var t=!!this.currentUser.email,e=!!this.currentUser.phone_number,n=!!(!!this.currentUser.identifier||t||e);return this.preChatFields.filter((function(r){return(!t||"emailAddress"!==r.name)&&((!e||"phoneNumber"!==r.name)&&(!n||"fullName"!==r.name))}))},enabledPreChatFields:function(){var t=this;return this.filteredPreChatFields.filter((function(t){return t.enabled})).map((function(e){return h(h({},e),{},{type:"phoneNumber"===e.name?"phoneInput":t.findFieldType(e.type)})}))},conversationCustomAttributes:function(){var t=this,e={};return this.enabledPreChatFields.forEach((function(n){"conversation_attribute"===n.field_type&&(e=h(h({},e),{},p({},n.name,t.getValue(n))))})),e},contactCustomAttributes:function(){var t=this,e={};return this.enabledPreChatFields.forEach((function(n){"contact_attribute"===n.field_type&&(e=h(h({},e),{},p({},n.name,t.getValue(n))))})),e},inputStyles:function(){return"mt-1 border rounded w-full py-2 px-3 text-slate-700 outline-none"},isInputDarkOrLightMode:function(){return"".concat(this.$dm("bg-white","dark:bg-slate-600")," ").concat(this.$dm("text-slate-700","dark:text-slate-50"))},inputBorderColor:function(){return"".concat(this.$dm("border-black-200","dark:border-black-500"))}}),methods:{labelClass:function(t){var e=t.hasErrors;return"text-xs font-medium ".concat(e?this.$dm("text-red-400","dark:text-red-400"):this.$dm("text-black-800","dark:text-slate-50"))},inputClass:function(t){var e=t.hasErrors,n=t.classification,r=t.type;return"box"===n&&"checkbox"===r?"":("phoneInput"===r&&(this.hasErrorInPhoneInput=e),e?"".concat(this.inputStyles," border-red-200 hover:border-red-300 focus:border-red-300 ").concat(this.isInputDarkOrLightMode):"".concat(this.inputStyles," hover:border-black-300 focus:border-black-300 ").concat(this.isInputDarkOrLightMode," ").concat(this.inputBorderColor))},isContactFieldRequired:function(t){return this.preChatFields.find((function(e){return e.name===t})).required},getLabel:function(t){return t.label},getPlaceHolder:function(t){return t.placeholder},getValue:function(t){var e=t.name;return"select"===t.type?this.enabledPreChatFields.find((function(t){return t.name===e})).values[this.formValues[e]]:this.formValues[e]||null},getValidation:function(t){var e=t.type,n=t.name,r=t.field_type,a=t.regex_pattern,i=a?this.getRegexp(a):null,o={emailAddress:"email",phoneNumber:["startsWithPlus","isValidPhoneNumber"],url:"url",date:"date",text:null,select:null,number:null,checkbox:!1,contact_attribute:i?[["matches",i]]:null,conversation_attribute:i?[["matches",i]]:null},s=Object.keys(o),u=this.isContactFieldRequired(n)?["bail","required"]:["bail","optional"];if(s.includes(n)||s.includes(e)||s.includes(r)){var l=o[e]||o[n]||o[r];return l?u.concat(l):u}return[]},findFieldType:function(t){return"link"===t?"url":"list"===t?"select":t},getOptions:function(t){if("select"===t.type){var e={};return t.values.forEach((function(t,n){e=h(h({},e),{},p({},n,t))})),e}return null},onSubmit:function(){var t=this.formValues,e=t.emailAddress,n=t.fullName,r=t.phoneNumber,a=t.message,i=this.currentUser.email;this.$emit("submit",{fullName:n,phoneNumber:r,emailAddress:e||i,message:a,activeCampaignId:this.activeCampaign.id,conversationCustomAttributes:this.conversationCustomAttributes,contactCustomAttributes:this.contactCustomAttributes})}}},g=(n(3300),n(6)),v=Object(g.a)(b,(function(){var t=this,e=t._self._c;return e("FormulateForm",{staticClass:"flex flex-1 flex-col p-6 overflow-y-auto",on:{submit:t.onSubmit},model:{value:t.formValues,callback:function(e){t.formValues=e},expression:"formValues"}},[t.shouldShowHeaderMessage?e("div",{directives:[{name:"dompurify-html",rawName:"v-dompurify-html",value:t.formatMessage(t.headerMessage,!1),expression:"formatMessage(headerMessage, false)"}],staticClass:"mb-4 text-sm leading-5 pre-chat-header-message",class:t.$dm("text-black-800","dark:text-slate-50")}):t._e(),t._v(" "),t._l(t.enabledPreChatFields,(function(n){return e("FormulateInput",{key:n.name,attrs:{name:n.name,type:n.type,label:t.getLabel(n),placeholder:t.getPlaceHolder(n),validation:t.getValidation(n),options:t.getOptions(n),"label-class":e=>t.labelClass(e),"input-class":e=>t.inputClass(e),"validation-messages":{startsWithPlus:t.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DIAL_CODE_VALID_ERROR"),isValidPhoneNumber:t.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.VALID_ERROR"),email:t.$t("PRE_CHAT_FORM.FIELDS.EMAIL_ADDRESS.VALID_ERROR"),required:t.$t("PRE_CHAT_FORM.REQUIRED"),matches:n.regex_cue?n.regex_cue:t.$t("PRE_CHAT_FORM.REGEX_ERROR")},"has-error-in-phone-input":t.hasErrorInPhoneInput}})})),t._v(" "),t.hasActiveCampaign?t._e():e("FormulateInput",{attrs:{name:"message",type:"textarea","label-class":e=>t.labelClass(e),"input-class":e=>t.inputClass(e),label:t.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.LABEL"),placeholder:t.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.PLACEHOLDER"),validation:"required","validation-messages":{required:t.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.ERROR")}}}),t._v(" "),e("custom-button",{staticClass:"font-medium mt-2 mb-5",attrs:{block:"","bg-color":t.widgetColor,"text-color":t.textColor,disabled:t.isCreating}},[t.isCreating?e("spinner",{staticClass:"p-0"}):t._e(),t._v("\n    "+t._s(t.$t("START_CONVERSATION"))+"\n  ")],1)],2)}),[],!1,null,"039b5644",null).exports,C=n(306),y={components:{PreChatForm:v},mixins:[f.a,l.a],mounted:function(){var t=this;bus.$on(C.c,(function(){t.replaceRoute("messages")}))},methods:{onSubmit:function(t){var e=t.fullName,n=t.emailAddress,r=t.message,a=t.activeCampaignId,i=t.phoneNumber,o=t.contactCustomAttributes,s=t.conversationCustomAttributes;a?(bus.$emit("execute-campaign",{campaignId:a,customAttributes:s}),this.$store.dispatch("contacts/update",{user:{email:n,name:e,phone_number:i}})):this.$store.dispatch("conversation/createConversation",{fullName:e,emailAddress:n,message:r,phoneNumber:i,customAttributes:s}),Object(u.d)(o)||this.$store.dispatch("contacts/setCustomAttributes",o)}}},_=Object(g.a)(y,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex flex-1 overflow-auto"},[e("pre-chat-form",{attrs:{options:t.preChatFormOptions},on:{submit:t.onSubmit}})],1)}),[],!1,null,null,null);e.default=_.exports}}]);
//# sourceMappingURL=60-52c37b850851bb254af8.chunk.js.map