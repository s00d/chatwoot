{"version":3,"sources":["webpack:///./node_modules/@june-so/analytics-next/dist/pkg/lib/is-plan-event-enabled.js","webpack:///./node_modules/@segment/analytics-core/dist/esm/validation/helpers.js","webpack:///./node_modules/@june-so/analytics-next/dist/pkg/plugins/ajs-destination/loader.js","webpack:///./node_modules/@june-so/analytics-next/dist/pkg/plugins/ajs-destination/index.js","webpack:///./node_modules/@june-so/analytics-next/dist/pkg/plugins/ajs-destination/utils.js"],"names":["isPlanEventEnabled","plan","planEvent","_a","_b","enabled","__default","isPlainObject","obj","Object","prototype","toString","call","slice","toLowerCase","normalizeName","name","replace","obfuscatePathName","pathName","obfuscate","btoa","undefined","loadIntegration","ctx","version","this","obfuscatedPathName","path","fullPath","err_1","deps","label","concat","trys","push","sent","metric","window","performance","getEntriesByName","stats","gauge","Math","round","duration","_","recordLoadMetrics","Promise","all","map","dep","flushQueue","xt","queue","failedQueue","_this","length","result","pop","failed","pushWithBackoff","LegacyDestination","settings","options","integrationSource","type","middleware","_ready","_initialized","flushing","disableAutoISOConversion","buffer","disableClientPersistence","scheduleFlush","isLoaded","ready","onReady","resolve","load","analyticsInstance","_c","integration","integrationSettings","integrationCtr","user","addIntegration","Integration","analytics","buildIntegration","once","onInitialize","on","increment","initialize","error","unload","_ctx","_analyticsInstance","unloadIntegration","addMiddleware","fn","_i","arguments","apply","shouldBuffer","event","send","clz","eventType","ev","afterMiddleware","track","updateEvent","integrations","All","cancel","retry","reason","traverse","invoke","page","_assumesPageview","then","identify","alias","group","setTimeout","todo","random","ajsDestinations","globalIntegrations","routingMiddleware","legacyIntegrationSources","routingRules","middlewareSettings","remoteIntegrationsConfig","localIntegrationsConfig","integrationOptions","adhocIntegrationSources","reduce","acc","resolveIntegrationNameFromSource","installableIntegrations","Set","keys","filter","bundlingStatus","versionSettings","deviceMode","componentTypes","includes","startsWith","isInstallableIntegration","Array","from","integrationName","allDisableAndNotDefined","_d","override","resolveVersion","destination","rule","destinationName"],"mappings":"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","file":"js/ajs-destination-742b6e8db7c6904cf55c.chunk.js","sourcesContent":["/**\n * Determines whether a track event is allowed to be sent based on the\n * user's tracking plan.\n * If the user does not have a tracking plan or the event is allowed based\n * on the tracking plan configuration, returns true.\n */\nexport function isPlanEventEnabled(plan, planEvent) {\n  var _a, _b; // Always prioritize the event's `enabled` status\n\n\n  if (typeof (planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) === 'boolean') {\n    return planEvent.enabled;\n  } // Assume absence of a tracking plan means events are enabled\n\n\n  return (_b = (_a = plan === null || plan === void 0 ? void 0 : plan.__default) === null || _a === void 0 ? void 0 : _a.enabled) !== null && _b !== void 0 ? _b : true;\n}","export function isString(obj) {\n  return typeof obj === 'string';\n}\nexport function isNumber(obj) {\n  return typeof obj === 'number';\n}\nexport function isFunction(obj) {\n  return typeof obj === 'function';\n}\nexport function isPlainObject(obj) {\n  return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase() === 'object';\n}\nexport function hasUser(event) {\n  var _a, _b, _c;\n\n  var id = (_c = (_b = (_a = event.userId) !== null && _a !== void 0 ? _a : event.anonymousId) !== null && _b !== void 0 ? _b : event.groupId) !== null && _c !== void 0 ? _c : event.previousId;\n  return isString(id);\n}","import { __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { getNextIntegrationsURL } from '../../lib/parse-cdn';\nimport { loadScript, unloadScript } from '../../lib/load-script';\n\nfunction normalizeName(name) {\n  return name.toLowerCase().replace('.', '').replace(/\\s+/g, '-');\n}\n\nfunction obfuscatePathName(pathName, obfuscate) {\n  if (obfuscate === void 0) {\n    obfuscate = false;\n  }\n\n  return obfuscate ? btoa(pathName).replace(/=/g, '') : undefined;\n}\n\nexport function resolveIntegrationNameFromSource(integrationSource) {\n  return ('Integration' in integrationSource ? integrationSource.Integration : integrationSource).prototype.name;\n}\n\nfunction recordLoadMetrics(fullPath, ctx, name) {\n  var _a, _b;\n\n  try {\n    var metric = ((_b = (_a = window === null || window === void 0 ? void 0 : window.performance) === null || _a === void 0 ? void 0 : _a.getEntriesByName(fullPath, 'resource')) !== null && _b !== void 0 ? _b : [])[0]; // we assume everything that took under 100ms is cached\n\n    metric && ctx.stats.gauge('legacy_destination_time', Math.round(metric.duration), __spreadArray([name], metric.duration < 100 ? ['cached'] : [], true));\n  } catch (_) {// not available\n  }\n}\n\nexport function buildIntegration(integrationSource, integrationSettings, analyticsInstance) {\n  var integrationCtr; // GA and Appcues use a different interface to instantiating integrations\n\n  if ('Integration' in integrationSource) {\n    var analyticsStub = {\n      user: function user() {\n        return analyticsInstance.user();\n      },\n      addIntegration: function addIntegration() {}\n    };\n    integrationSource(analyticsStub);\n    integrationCtr = integrationSource.Integration;\n  } else {\n    integrationCtr = integrationSource;\n  }\n\n  var integration = new integrationCtr(integrationSettings);\n  integration.analytics = analyticsInstance;\n  return integration;\n}\nexport function loadIntegration(ctx, name, version, obfuscate) {\n  return __awaiter(this, void 0, void 0, function () {\n    var pathName, obfuscatedPathName, path, fullPath, err_1, deps;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          pathName = normalizeName(name);\n          obfuscatedPathName = obfuscatePathName(pathName, obfuscate);\n          path = getNextIntegrationsURL();\n          fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n          _a.label = 1;\n\n        case 1:\n          _a.trys.push([1, 3,, 4]);\n\n          return [4\n          /*yield*/\n          , loadScript(fullPath)];\n\n        case 2:\n          _a.sent();\n\n          recordLoadMetrics(fullPath, ctx, name);\n          return [3\n          /*break*/\n          , 4];\n\n        case 3:\n          err_1 = _a.sent();\n          ctx.stats.gauge('legacy_destination_time', -1, [\"plugin:\".concat(name), \"failed\"]);\n          throw err_1;\n\n        case 4:\n          deps = window[\"\".concat(pathName, \"Deps\")];\n          return [4\n          /*yield*/\n          , Promise.all(deps.map(function (dep) {\n            return loadScript(path + dep + '.gz');\n          })) // @ts-ignore\n          ];\n\n        case 5:\n          _a.sent(); // @ts-ignore\n\n\n          window[\"\".concat(pathName, \"Loader\")]();\n          return [2\n          /*return*/\n          , window[// @ts-ignore\n          \"\".concat(pathName, \"Integration\")]];\n      }\n    });\n  });\n}\nexport function unloadIntegration(name, version, obfuscate) {\n  return __awaiter(this, void 0, void 0, function () {\n    var path, pathName, obfuscatedPathName, fullPath;\n    return __generator(this, function (_a) {\n      path = getNextIntegrationsURL();\n      pathName = normalizeName(name);\n      obfuscatedPathName = obfuscatePathName(name, obfuscate);\n      fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n      return [2\n      /*return*/\n      , unloadScript(fullPath)];\n    });\n  });\n}\nexport function resolveVersion(settings) {\n  var _a, _b, _c, _d;\n\n  return (_d = (_b = (_a = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _a === void 0 ? void 0 : _a.override) !== null && _b !== void 0 ? _b : (_c = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _c === void 0 ? void 0 : _c.version) !== null && _d !== void 0 ? _d : 'latest';\n}","import { __assign, __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { Alias, Group, Identify, Page, Track } from '@segment/facade';\nimport { isOffline, isOnline } from '../../core/connection';\nimport { Context, ContextCancelation } from '../../core/context';\nimport { isServer } from '../../core/environment';\nimport { attempt } from '@segment/analytics-core';\nimport { isPlanEventEnabled } from '../../lib/is-plan-event-enabled';\nimport { mergedOptions } from '../../lib/merged-options';\nimport { pWhile } from '../../lib/p-while';\nimport { PriorityQueue } from '../../lib/priority-queue';\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted';\nimport { applyDestinationMiddleware } from '../middleware';\nimport { buildIntegration, loadIntegration, resolveIntegrationNameFromSource, resolveVersion, unloadIntegration } from './loader';\nimport { isPlainObject } from '@segment/analytics-core';\nimport { isDisabledIntegration as shouldSkipIntegration, isInstallableIntegration } from './utils';\n\nfunction flushQueue(xt, queue) {\n  return __awaiter(this, void 0, void 0, function () {\n    var failedQueue;\n\n    var _this = this;\n\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          failedQueue = [];\n\n          if (isOffline()) {\n            return [2\n            /*return*/\n            , queue];\n          }\n\n          return [4\n          /*yield*/\n          , pWhile(function () {\n            return queue.length > 0 && isOnline();\n          }, function () {\n            return __awaiter(_this, void 0, void 0, function () {\n              var ctx, result, success;\n              return __generator(this, function (_a) {\n                switch (_a.label) {\n                  case 0:\n                    ctx = queue.pop();\n\n                    if (!ctx) {\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    return [4\n                    /*yield*/\n                    , attempt(ctx, xt)];\n\n                  case 1:\n                    result = _a.sent();\n                    success = result instanceof Context;\n\n                    if (!success) {\n                      failedQueue.push(ctx);\n                    }\n\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            });\n          }) // re-add failed tasks\n          ];\n\n        case 1:\n          _a.sent(); // re-add failed tasks\n\n\n          failedQueue.map(function (failed) {\n            return queue.pushWithBackoff(failed);\n          });\n          return [2\n          /*return*/\n          , queue];\n      }\n    });\n  });\n}\n\nvar LegacyDestination =\n/** @class */\nfunction () {\n  function LegacyDestination(name, version, settings, options, integrationSource) {\n    if (settings === void 0) {\n      settings = {};\n    }\n\n    this.options = {};\n    this.type = 'destination';\n    this.middleware = [];\n    this._ready = false;\n    this._initialized = false;\n    this.flushing = false;\n    this.name = name;\n    this.version = version;\n    this.settings = __assign({}, settings);\n    this.disableAutoISOConversion = options.disableAutoISOConversion || false;\n    this.integrationSource = integrationSource; // AJS-Renderer sets an extraneous `type` setting that clobbers\n    // existing type defaults. We need to remove it if it's present\n\n    if (this.settings['type'] && this.settings['type'] === 'browser') {\n      delete this.settings['type'];\n    }\n\n    this.options = options;\n    this.buffer = options.disableClientPersistence ? new PriorityQueue(4, []) : new PersistedPriorityQueue(4, \"dest-\".concat(name));\n    this.scheduleFlush();\n  }\n\n  LegacyDestination.prototype.isLoaded = function () {\n    return this._ready;\n  };\n\n  LegacyDestination.prototype.ready = function () {\n    var _a;\n\n    return (_a = this.onReady) !== null && _a !== void 0 ? _a : Promise.resolve();\n  };\n\n  LegacyDestination.prototype.load = function (ctx, analyticsInstance) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var integrationSource, _b;\n\n      var _this = this;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (this._ready || this.onReady !== undefined) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            if (!((_a = this.integrationSource) !== null && _a !== void 0)) return [3\n            /*break*/\n            , 1];\n            _b = _a;\n            return [3\n            /*break*/\n            , 3];\n\n          case 1:\n            return [4\n            /*yield*/\n            , loadIntegration(ctx, this.name, this.version, this.options.obfuscate)];\n\n          case 2:\n            _b = _c.sent();\n            _c.label = 3;\n\n          case 3:\n            integrationSource = _b;\n            this.integration = buildIntegration(integrationSource, this.settings, analyticsInstance);\n            this.onReady = new Promise(function (resolve) {\n              var onReadyFn = function onReadyFn() {\n                _this._ready = true;\n                resolve(true);\n              };\n\n              _this.integration.once('ready', onReadyFn);\n            });\n            this.onInitialize = new Promise(function (resolve) {\n              var onInit = function onInit() {\n                _this._initialized = true;\n                resolve(true);\n              };\n\n              _this.integration.on('initialize', onInit);\n            });\n\n            try {\n              ctx.stats.increment('analytics_js.integration.invoke', 1, [\"method:initialize\", \"integration_name:\".concat(this.name)]);\n              this.integration.initialize();\n            } catch (error) {\n              ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\"method:initialize\", \"integration_name:\".concat(this.name)]);\n              throw error;\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  LegacyDestination.prototype.unload = function (_ctx, _analyticsInstance) {\n    return unloadIntegration(this.name, this.version, this.options.obfuscate);\n  };\n\n  LegacyDestination.prototype.addMiddleware = function () {\n    var _a;\n\n    var fn = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      fn[_i] = arguments[_i];\n    }\n\n    this.middleware = (_a = this.middleware).concat.apply(_a, fn);\n  };\n\n  LegacyDestination.prototype.shouldBuffer = function (ctx) {\n    return (// page events can't be buffered because of destinations that automatically add page views\n      ctx.event.type !== 'page' && (isOffline() || this._ready === false || this._initialized === false)\n    );\n  };\n\n  LegacyDestination.prototype.send = function (ctx, clz, eventType) {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var plan, ev, planEvent, afterMiddleware, event, err_1;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (this.shouldBuffer(ctx)) {\n              this.buffer.push(ctx);\n              this.scheduleFlush();\n              return [2\n              /*return*/\n              , ctx];\n            }\n\n            plan = (_b = (_a = this.options) === null || _a === void 0 ? void 0 : _a.plan) === null || _b === void 0 ? void 0 : _b.track;\n            ev = ctx.event.event;\n\n            if (plan && ev && this.name !== 'june.so') {\n              planEvent = plan[ev];\n\n              if (!isPlanEventEnabled(plan, planEvent)) {\n                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), {\n                  All: false,\n                  'june.so': true\n                }));\n                ctx.cancel(new ContextCancelation({\n                  retry: false,\n                  reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                  type: 'Dropped by plan'\n                }));\n                return [2\n                /*return*/\n                , ctx];\n              } else {\n                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations));\n              }\n\n              if ((planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) && (planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations[this.name]) === false) {\n                ctx.cancel(new ContextCancelation({\n                  retry: false,\n                  reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                  type: 'Dropped by plan'\n                }));\n                return [2\n                /*return*/\n                , ctx];\n              }\n            }\n\n            return [4\n            /*yield*/\n            , applyDestinationMiddleware(this.name, ctx.event, this.middleware)];\n\n          case 1:\n            afterMiddleware = _c.sent();\n\n            if (afterMiddleware === null) {\n              return [2\n              /*return*/\n              , ctx];\n            }\n\n            event = new clz(afterMiddleware, {\n              traverse: !this.disableAutoISOConversion\n            });\n            ctx.stats.increment('analytics_js.integration.invoke', 1, [\"method:\".concat(eventType), \"integration_name:\".concat(this.name)]);\n            _c.label = 2;\n\n          case 2:\n            _c.trys.push([2, 5,, 6]);\n\n            if (!this.integration) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , this.integration.invoke.call(this.integration, eventType, event)];\n\n          case 3:\n            _c.sent();\n\n            _c.label = 4;\n\n          case 4:\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_1 = _c.sent();\n            ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\"method:\".concat(eventType), \"integration_name:\".concat(this.name)]);\n            throw err_1;\n\n          case 6:\n            return [2\n            /*return*/\n            , ctx];\n        }\n      });\n    });\n  };\n\n  LegacyDestination.prototype.track = function (ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, Track, 'track')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.page = function (ctx) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        if (((_a = this.integration) === null || _a === void 0 ? void 0 : _a._assumesPageview) && !this._initialized) {\n          this.integration.initialize();\n        }\n\n        return [2\n        /*return*/\n        , this.onInitialize.then(function () {\n          return _this.send(ctx, Page, 'page');\n        })];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.identify = function (ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, Identify, 'identify')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.alias = function (ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, Alias, 'alias')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.group = function (ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, Group, 'group')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.scheduleFlush = function () {\n    var _this = this;\n\n    if (this.flushing) {\n      return;\n    } // eslint-disable-next-line @typescript-eslint/no-misused-promises\n\n\n    setTimeout(function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              this.flushing = true;\n              _a = this;\n              return [4\n              /*yield*/\n              , flushQueue(this, this.buffer)];\n\n            case 1:\n              _a.buffer = _b.sent();\n              this.flushing = false;\n\n              if (this.buffer.todo > 0) {\n                this.scheduleFlush();\n              }\n\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    }, Math.random() * 5000);\n  };\n\n  return LegacyDestination;\n}();\n\nexport { LegacyDestination };\nexport function ajsDestinations(settings, globalIntegrations, options, routingMiddleware, legacyIntegrationSources) {\n  var _a, _b;\n\n  if (globalIntegrations === void 0) {\n    globalIntegrations = {};\n  }\n\n  if (options === void 0) {\n    options = {};\n  }\n\n  if (isServer()) {\n    return [];\n  }\n\n  if (settings.plan) {\n    options = options !== null && options !== void 0 ? options : {};\n    options.plan = settings.plan;\n  }\n\n  var routingRules = (_b = (_a = settings.middlewareSettings) === null || _a === void 0 ? void 0 : _a.routingRules) !== null && _b !== void 0 ? _b : [];\n  var remoteIntegrationsConfig = settings.integrations;\n  var localIntegrationsConfig = options.integrations; // merged remote CDN settings with user provided options\n\n  var integrationOptions = mergedOptions(settings, options !== null && options !== void 0 ? options : {});\n  var adhocIntegrationSources = legacyIntegrationSources === null || legacyIntegrationSources === void 0 ? void 0 : legacyIntegrationSources.reduce(function (acc, integrationSource) {\n    var _a;\n\n    return __assign(__assign({}, acc), (_a = {}, _a[resolveIntegrationNameFromSource(integrationSource)] = integrationSource, _a));\n  }, {});\n  var installableIntegrations = new Set(__spreadArray(__spreadArray([], Object.keys(remoteIntegrationsConfig).filter(function (name) {\n    return isInstallableIntegration(name, remoteIntegrationsConfig[name]);\n  }), true), Object.keys(adhocIntegrationSources || {}).filter(function (name) {\n    return isPlainObject(remoteIntegrationsConfig[name]) || isPlainObject(localIntegrationsConfig === null || localIntegrationsConfig === void 0 ? void 0 : localIntegrationsConfig[name]);\n  }), true));\n  return Array.from(installableIntegrations).filter(function (name) {\n    return !shouldSkipIntegration(name, globalIntegrations);\n  }).map(function (name) {\n    var integrationSettings = remoteIntegrationsConfig[name];\n    var version = resolveVersion(integrationSettings);\n    var destination = new LegacyDestination(name, version, integrationOptions[name], options, adhocIntegrationSources === null || adhocIntegrationSources === void 0 ? void 0 : adhocIntegrationSources[name]);\n    var routing = routingRules.filter(function (rule) {\n      return rule.destinationName === name;\n    });\n\n    if (routing.length > 0 && routingMiddleware) {\n      destination.addMiddleware(routingMiddleware);\n    }\n\n    return destination;\n  });\n}","export var isInstallableIntegration = function isInstallableIntegration(name, integrationSettings) {\n  var _a;\n\n  var type = integrationSettings.type,\n      bundlingStatus = integrationSettings.bundlingStatus,\n      versionSettings = integrationSettings.versionSettings; // We use `!== 'unbundled'` (versus `=== 'bundled'`) to be inclusive of\n  // destinations without a defined value for `bundlingStatus`\n\n  var deviceMode = bundlingStatus !== 'unbundled' && (type === 'browser' || ((_a = versionSettings === null || versionSettings === void 0 ? void 0 : versionSettings.componentTypes) === null || _a === void 0 ? void 0 : _a.includes('browser'))); // checking for iterable is a quick fix we need in place to prevent\n  // errors showing Iterable as a failed destiantion. Ideally, we should\n  // fix the Iterable metadata instead, but that's a longer process.\n\n  return !name.startsWith('Segment') && name !== 'Iterable' && deviceMode;\n};\nexport var isDisabledIntegration = function isDisabledIntegration(integrationName, globalIntegrations) {\n  var allDisableAndNotDefined = globalIntegrations.All === false && globalIntegrations[integrationName] === undefined;\n  return globalIntegrations[integrationName] === false || allDisableAndNotDefined;\n};"],"sourceRoot":""}